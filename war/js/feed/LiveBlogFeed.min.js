LiveBlogFeed=function(a,b){this.blogId=b;this.container=a;this.$container=$j(this.container);this.latestMessageDate=new Date(0);this.latestGameDate=new Date(0);this.initialized=false};LiveBlogFeed.prototype={render:function(){this.team1=document.getElementById("t1");this.team2=document.getElementById("t2");this.logo1=document.getElementById("t1logo");this.logo2=document.getElementById("t2logo");this.score1=document.getElementById("score1");this.score2=document.getElementById("score2");this.shots1=document.getElementById("shots1");this.shots2=document.getElementById("shots2");this.t1pp=document.getElementById("t1pp");this.t2pp=document.getElementById("t2pp");this.timer=document.getElementById("time");this.period=document.getElementById("period");this.container.className="consoleScrollerFeed"},initialize:function(){this.container.innerHTML="";this.fetchAllMessages();setInterval(this.fetchNewMessages.bind(this),5000);setInterval(this.refreshScore.bind(this),10000);this.initScoreboard()},initScoreboard:function(){$j.ajax({url:location.protocol+"//"+location.host+"/api/game/"+this.blogId,success:function(a){this.logo1.src="/api/teams/image/"+a.team1.key.id;this.logo2.src="/api/teams/image/"+a.team2.key.id;this.team1.innerHTML=a.team1.name;$j(this.team1).boxfit({multiline:true});this.team2.innerHTML=a.team2.name;$j(this.team2).boxfit({multiline:true});this.updateScore(a)}.bind(this),error:function(){console.error("Failed to get scoreboard information.")}})},refreshScore:function(){$j.ajax({url:location.protocol+"//"+location.host+"/api/game/"+this.blogId+"/"+this.latestGameDate.getTime(),context:this,success:this.updateScore,error:function(){console.error("Failed to refresh scoreboard information.")}})},updateScore:function(a){if(a&&!$j.isEmptyObject(a)){this.score1.innerHTML=a.team1goals;this.score2.innerHTML=a.team2goals;this.shots1.innerHTML="Shots: "+a.team1sog;this.shots2.innerHTML="Shots: "+a.team2sog;a.team1pp?$j(this.t1pp).slideDown():$j(this.t1pp).slideUp();a.team2pp?$j(this.t2pp).slideDown():$j(this.t2pp).slideUp();this.timer.innerHTML=a.time;this.period.innerHTML="Per "+a.period;this.latestGameDate=new Date(a.lastUpdated)}},addMessage:function(c){var a=document.createElement("div");var d=document.createElement("div");var b=document.createElement("div");if(c.isUserComment){a.className="panel panel-warning"}else{a.className="panel panel-info"}d.className="panel-heading";b.className="panel-body";d.innerHTML=c.author+'<span class="panel-right">'+new Date(c.time).toLocaleTimeString()+"</span>";b.innerHTML=c.text;a.appendChild(d);a.appendChild(b);a.style.display="none";this.container.appendChild(a);if(this.initialized){$j(a).slideDown(700,function(){$j(this.container).animate({scrollTop:this.container.scrollHeight-this.container.offsetHeight})}.bind(this))}else{a.style.display=""}},fetchAllMessages:function(){$j.ajax({url:location.protocol+"//"+location.host+"/api/messages/"+this.blogId,success:function(a){var b=a.messages;b.forEach(function(c){this.addMessage(c)}.bind(this));if(a.latestTime){this.latestMessageDate=new Date(a.latestTime)}$j(this.container).animate({scrollTop:this.container.scrollHeight-this.container.offsetHeight});this.initialized=true}.bind(this),error:function(a,b,c){console.error("Error: "+c)}})},fetchNewMessages:function(){$j.ajax({url:location.protocol+"//"+location.host+"/api/messages/"+this.blogId+"/"+this.latestMessageDate.getTime(),success:function(a){var b=a.messages;b.forEach(function(c){this.addMessage(c)}.bind(this));if(a.latestTime){this.latestMessageDate=new Date(a.latestTime)}if(b.length>0){$j(this.container).animate({scrollTop:this.container.scrollHeight-this.container.offsetHeight})}}.bind(this),error:function(a,b,c){console.error("Error fetching new messages")}})}};