ScoreBoardConsole=function(a){this.containerId=a;this.container=document.getElementById(a);this.$container=$j(this.container);this.teams=null};ScoreBoardConsole.prototype={render:function(){var a=document.getElementById("teamManageLink");a.onclick=function(){window.open("teamManager.jsp","newwindow","width=650px, height=325px")};this.team1Selector=document.getElementById("team1select");$j(this.team1Selector).on("change",this.updateTeam);this.team2Selector=document.getElementById("team2select");$j(this.team2Selector).on("change",this.updateTeam);this.initializeTeams();this.team1ScoreBox=document.getElementById("team1scorebox");this.team2ScoreBox=document.getElementById("team2scorebox");this.team1ShotsBox=document.getElementById("team1shotsbox");this.team2ShotsBox=document.getElementById("team2shotsbox");this.team1PowerPlay=document.getElementById("team1pp");this.team2PowerPlay=document.getElementById("team2pp");this.timeBox=document.getElementById("timeControl");this.periodBox=document.getElementById("periodControl");this.scoreIndicator=document.getElementById("scoreIndicator");$j(this.team1ScoreBox).change(this.queueUpdate.bind(this));$j(this.team2ScoreBox).change(this.queueUpdate.bind(this));$j(this.team1ShotsBox).change(this.queueUpdate.bind(this));$j(this.team2ShotsBox).change(this.queueUpdate.bind(this));$j(this.team1PowerPlay).change(this.queueUpdate.bind(this));$j(this.team2PowerPlay).change(this.queueUpdate.bind(this));$j(this.timeBox).change(this.queueUpdate.bind(this));$j(this.periodBox).change(this.queueUpdate.bind(this))},initializeTeams:function(){$j.ajax({url:location.protocol+"//"+location.host+"/api/teams",context:this,dataType:"json",success:function(a){this.teams=a;$j(this.team1Selector).on("change",function(){var c=this.team1Selector.selectedIndex;var b=this.team2Selector.selectedIndex;this.team2Selector.innerHTML="";for(var f=0;f<this.teams.length;f++){if(f!=this.team1Selector.selectedIndex){var e=document.createElement("option");e.setAttribute("id",this.teams[f].key.id);e.innerHTML=this.teams[f].name;this.team2Selector.appendChild(e)}}var d;if(c<b){d=b-1}else{d=Math.max(b,0)}this.team2Selector.selectedIndex=d}.bind(this));a.forEach(function(b){if(b!=""){var c=document.createElement("option");c.setAttribute("id",b.key.id);c.innerHTML=b.name;this.team1Selector.appendChild(c)}}.bind(this));$j(this.team1Selector).trigger("change")},error:function(a){console.error("Could not fetch teams!")}})},queueUpdate:function(){if(!adminConsole.gameId){return}$j(this.scoreIndicator).removeClass("fa-check fa-times").addClass("fa-refresh");if(this.timeout){clearTimeout(this.timeout)}this.timeout=setTimeout(this.sendUpdate.bind(this),5000)},sendUpdate:function(){var a={team1goals:this.team1ScoreBox.value,team2goals:this.team2ScoreBox.value,team1sog:this.team1ShotsBox.value,team2sog:this.team2ShotsBox.value,team1pp:this.team1PowerPlay.checked,team2pp:this.team2PowerPlay.checked,time:this.timeBox.value,period:this.periodBox.value};$j.ajax({url:location.protocol+"//"+location.host+"/api/game/"+adminConsole.gameId,method:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(a),context:this,success:function(b){this.loadScoreInfo(b);$j(this.scoreIndicator).removeClass("fa-refresh fa-times").addClass("fa-check")},error:function(){$j(this.scoreIndicator).removeClass("fa-refresh fa-check").addClass("fa-times");console.error("Failed to send score update. Retrying in 10 seconds");this.timeout=setTimeout(this.sendUpdate.bind(this),10000)}})},loadTeams:function(c){var e=c.team1.key.id;var b=c.team2.key.id;var a=false;var f=false;for(var d=0;d<this.team1Selector.children.length;d++){if(this.team1Selector.children[d].id==e){this.team1Selector.selectedIndex=d;a=true;break}}$j(this.team1Selector).trigger("change");for(var d=0;d<this.team2Selector.children.length;d++){if(this.team2Selector.children[d].id==b){this.team2Selector.selectedIndex=d;f=true;break}}if(!a||!f){console.error("Error loading game: "+c.name)}},loadScoreInfo:function(a){this.team1ScoreBox.value=a.team1goals;this.team2ScoreBox.value=a.team2goals;this.team1ShotsBox.value=a.team1sog;this.team2ShotsBox.value=a.team2sog;this.team1PowerPlay.checked=a.team1pp;this.team2PowerPlay.checked=a.team2pp;this.timeBox.value=a.time;this.periodBox.value=a.period},updateTeam:function(){if(!adminConsole||!adminConsole.gameId){return}var b;if(this.id=="team1select"){b=1}else{if(this.id=="team2select"){b=2}else{return}}var a=this.children[this.selectedIndex];$j.ajax({url:location.protocol+"//"+location.host+"/api/game/"+adminConsole.gameId+"/"+b,method:"POST",contentType:"text/plain",dataType:"json",data:a.id,context:this,timeout:2000,success:function(c){adminConsole.gameId=c.key.id;adminConsole.setGameName(c.name)},error:function(c,d,e){console.error("Failed to update Game.")}})}};