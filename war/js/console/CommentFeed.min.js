CommentFeed=function(a){this.container=document.getElementById(a);this.latestMessageDate=new Date(0);this.initialized=false};CommentFeed.prototype={initialize:function(){this.container.innerHTML="";this.fetchAllMessages();if(this.interval){clearInterval(this.interval)}this.interval=setInterval(this.fetchNewMessages.bind(this),5000)},addMessage:function(c){var a=document.createElement("div");var g=document.createElement("div");var b=document.createElement("div");a.id="message_"+c.key.id;a.className="panel panel-warning";g.className="panel-heading";g.innerHTML=c.author+'<span class="panel-right">'+new Date(c.time).toLocaleTimeString()+"</span>";b.innerHTML=c.text;var e=document.createElement("input");e.type="button";e.value="Approve";e.className="floatR btn btn-success btn-sm commentButton bottomLeft";var f=document.createElement("input");f.type="button";f.value="Delete";f.className="floatR btn btn-danger btn-sm commentButton bottomRight";a.appendChild(g);a.appendChild(b);var d=a.cloneNode(true);b.style.paddingBottom="30px";b.appendChild(f);b.appendChild(e);$j(f).on("click",function(){$j("#confirmModalContent").html("");$j("#confirmModalContent").append(d);$j("#confirmModalYes").one("click",function(){this.deleteMessage(c.key.id)}.bind(this));$j("#confirmModal").modal()}.bind(this));$j(e).on("click",function(){this.approveMessage(c.key.id)}.bind(this));a.style.display="none";this.container.appendChild(a);if(this.initialized){$j(a).slideDown(700,function(){$j(this.container).animate({scrollTop:this.container.scrollHeight-this.container.offsetHeight})}.bind(this))}else{a.style.display=""}},deleteMessage:function(a){$j.ajax({url:location.protocol+"//"+location.host+"/api/messages/delete/"+a,context:this,success:function(){$j("#message_"+a).slideUp(700,function(){$j(this).remove()})},error:function(){console.error("Could not delete message "+a)}})},approveMessage:function(a){$j.ajax({url:location.protocol+"//"+location.host+"/api/messages/approve/"+a,context:this,success:function(){$j("#message_"+a).slideUp(700,function(){$j(this).remove()})},error:function(){console.error("Could not approve message "+a)}})},fetchAllMessages:function(){$j.ajax({url:location.protocol+"//"+location.host+"/api/messages/pending/"+adminConsole.gameId,success:function(a){var b=a.messages;b.forEach(function(c){this.addMessage(c)}.bind(this));if(a.latestTime){this.latestMessageDate=new Date(a.latestTime)}this.initialized=true}.bind(this),error:function(a,b,c){console.error("Error: "+c)}})},fetchNewMessages:function(){$j.ajax({url:location.protocol+"//"+location.host+"/api/messages/pending/"+adminConsole.gameId+"/"+this.latestMessageDate.getTime(),success:function(a){var b=a.messages;b.forEach(function(c){this.addMessage(c)}.bind(this));if(a.latestTime){this.latestMessageDate=new Date(a.latestTime)}if(b.length>0){$j(this.container).animate({scrollTop:this.container.scrollHeight-this.container.offsetHeight})}}.bind(this),error:function(a,b,c){console.error("Error fetching new messages")}})}};